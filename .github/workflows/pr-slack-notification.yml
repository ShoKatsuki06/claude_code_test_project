name: Pull Request Slack Notification

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  notify-slack:
    runs-on: ubuntu-latest
    
    steps:
      - name: Send Slack notification via webhook
        run: |
          # Prepare the message based on action type
          if [ "${{ github.event.action }}" = "opened" ]; then
            ACTION_MSG="ğŸ”” æ–°ã—ã„ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸ"
            COLOR="good"
          else
            ACTION_MSG="ğŸ“ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ"
            COLOR="warning"
          fi
          
          # Send notification to Slack
          curl -X POST -H 'Content-type: application/json' \
          --data "{
            \"channel\": \"#claude_code_notification\",
            \"username\": \"GitHub Actions\",
            \"icon_emoji\": \":github:\",
            \"attachments\": [
              {
                \"color\": \"$COLOR\",
                \"title\": \"$ACTION_MSG\",
                \"title_link\": \"${{ github.event.pull_request.html_url }}\",
                \"fields\": [
                  {
                    \"title\": \"ãƒªãƒã‚¸ãƒˆãƒª\",
                    \"value\": \"${{ github.repository }}\",
                    \"short\": true
                  },
                  {
                    \"title\": \"ä½œæˆè€…\",
                    \"value\": \"${{ github.event.pull_request.user.login }}\",
                    \"short\": true
                  },
                  {
                    \"title\": \"ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\",
                    \"value\": \"${{ github.event.pull_request.title }}\",
                    \"short\": false
                  },
                  {
                    \"title\": \"ãƒ–ãƒ©ãƒ³ãƒ\",
                    \"value\": \"${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}\",
                    \"short\": false
                  }
                ],
                \"footer\": \"GitHub Actions\",
                \"ts\": $(date +%s)
              }
            ]
          }" \
          ${{ secrets.SLACK_WEBHOOK_URL }}